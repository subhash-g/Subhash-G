<div id="top-bar">
	<div class="logo">
		<img src="<%= logo %>" />
	</div>
</div>

<div id="title-bar"><%= name %> - Email Preferences</div>

<div id="content">
	<div class="form">
		<fieldset>
			<span class="title">Your Profile</span>
			<% profile.forEach(function(prop) { %>
				<label><%= prop.name %></label>
				<input type="text" class="profile-input" name="fname" data-property="<%= prop.property %>" value="<%= prop.value %>">
			<% }); %>
		</fieldset>
		
		<fieldset>
			<span class="title">Your Email List</span>
			<% counter = 1 %>
			<% lists.forEach(function(list) { %>
				
				<input type="checkbox" id="checkboxG<%= counter %>" class="css-checkbox list-input" data-property="<%= list.property %>" <%= list.value == 'true' ? 'checked' : '' %> />
				
				<label for="checkboxG<%= counter%>" class="css-label radGroup1" checked><%= list.name %></label><br />
				<% counter++ %>
			<% }); %>
			
		</fieldset>
		
		<input id="btnSavePreferences" class="btn" type="submit" value="Save Preferences">
		
	</div>
</div>

<script>
$("#btnSavePreferences").click(function() {
  var preferences = {};

	$(".profile-input").toArray().forEach(function(item) { 
		var key = $(item).attr("data-property");
		preferences[key] = $(item).val();
	});
	
	$(".list-input").toArray().forEach(function(item) { 
		var key = $(item).attr("data-property");
		preferences[key] = item.checked ? "true": "false";
	});
	
	var url = "/preferences/<%= customerId %>/users/<%= userId %>";
	
	$.ajax({
		url: url,
		method: 'POST',
		data: JSON.stringify(preferences),
		beforeSend: function(xhr, settings) {
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.setRequestHeader("Accept", "application/json");
		},
		success: function(data, status, xhr) {
			alert("Preferences successfully updated.");
		},
		error: function(xhr, status, error) {
			alert("An error occurred updating your preferences(" + error.message + ").  Please try again.");
		}
	});
	
	return false;
});
</script>

<script type="text/javascript" src="/js/jspatch.js"></script>
