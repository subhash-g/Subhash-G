<div id="top-bar">
	<div class="logo">
		<img src="/images/boomtrain.png" />
	</div>
</div>

<div id="title-bar">
	<div class="logo">
		<img src="<%= logo %>" />
	</div>
</div>

<div id="body">
	<div id="left-menu">
		<div class="menu-items">
			<div class="menu-item">
				<a id="btn-my-profile" href="#">My Profile</a>
			</div>
			<div class="menu-item">
				<a id="btn-my-list" href="#">My Lists</a>
			</div>
		</div>
	</div>

	<div id="content">
		<div id="profile-form" class="form">
			<div class="fieldset-container">
				<fieldset>
					<% profile.forEach(function(prop, index) { %>
						<% if(index % 2 == 0) { %>
							<label><%= prop.name %></label>
							<input type="text" class="profile-input" data-property="<%= prop.property %>" value="<%= prop.value %>">
						<% } %>
					<% }); %>
				</fieldset>
				<fieldset>
					<% profile.forEach(function(prop, index) { %>
						<% if(index % 2 == 1) { %>
							<label><%= prop.name %></label>
							<input type="text" class="profile-input" data-property="<%= prop.property %>" value="<%= prop.value %>">
						<% } %>
					<% }); %>
				</fieldset>
			</div>
			<div>
				<input class="btn btn-save" type="submit" value="Save Profile">
			</div>
		</div>
		<div id="list-form" class="form">
			<div class="fieldset-container">
				<% counter = 1 %>
				<fieldset>
					<% lists.forEach(function(list, index) { %>
						<% if(index % 2 == 0) { %>
							<input type="checkbox" id="checkboxG<%= counter %>" class="css-checkbox list-input" data-property="<%= list.property %>" <%= list.value == 'true' ? 'checked' : '' %> />
							<label for="checkboxG<%= counter%>" class="css-label radGroup1" checked><%= list.name %></label><br />
							<% counter++ %>
						<% } %>
					<% }); %>
				</fieldset>
				<fieldset>
					<% lists.forEach(function(list, index) { %>
						<% if(index % 2 == 1) { %>
							<input type="checkbox" id="checkboxG<%= counter %>" class="css-checkbox list-input" data-property="<%= list.property %>" <%= list.value == 'true' ? 'checked' : '' %> />
							<label for="checkboxG<%= counter%>" class="css-label radGroup1" checked><%= list.name %></label><br />
							<% counter++ %>
						<% } %>
					<% }); %>
				</fieldset>
			</div>
			<div>
				<input class="btn btn-save" type="submit" value="Save My List">
			</div>
		</div>
	</div>
</div>

<script>
var selectMyProfile = function() {
	$("#list-form").hide();
	$("#btn-my-list").removeClass("selected");
	$("#profile-form").show();
	$("#btn-my-profile").addClass("selected");
}

var selectMyList = function() {
	$("#profile-form").hide();
	$("#btn-my-profile").removeClass("selected");
	$("#list-form").show();
	$("#btn-my-list").addClass("selected");
}

$("#btn-my-profile").click(selectMyProfile);
$("#btn-my-list").click(selectMyList);
selectMyProfile();

$(".btn-save").click(function() {
  var preferences = {};

	$(".profile-input").toArray().forEach(function(item) { 
		var key = $(item).attr("data-property");
		preferences[key] = $(item).val();
	});
	
	$(".list-input").toArray().forEach(function(item) { 
		var key = $(item).attr("data-property");
		preferences[key] = item.checked ? "true": "false";
	});
	
	var url = "/preferences/<%= customerId %>/users/<%= userId %>";
	
	$.ajax({
		url: url,
		method: 'POST',
		data: JSON.stringify(preferences),
		beforeSend: function(xhr, settings) {
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.setRequestHeader("Accept", "application/json");
		},
		success: function(data, status, xhr) {
			alert("Preferences successfully updated.");
		},
		error: function(xhr, status, error) {
			alert("An error occurred updating your preferences(" + error.message + ").  Please try again.");
		}
	});
	
	mixpanel.track("preferences-updated", {'customerId': <%= customerId %> });
	
	return false;
});
</script>

<script>
mixpanel.track("page-load", {'customerId': <%= customerId %> });
</script>

<script type="text/javascript" src="/js/jspatch.js"></script>
